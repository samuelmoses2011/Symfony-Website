{% extends '@IIABMagnet/Admin/standard_layout.html.twig' %}

{% block sonata_admin_content %}

    <div class="panel panel-default">
        {{ include('@IIABMagnet/Admin/ProgramProcessing/header.html.twig') }}
    </div>

    {{ render( controller('IIABMagnetBundle:ProgramProcessing:processingStatus') ) }}

    <div class="row">
        <div class="col-md-12">
            {{ form_start(form) }}
            <div class="nav-tabs-custom">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#enrollment_settings" aria-controls="enrollment_settings" role="tab" data-toggle="tab">Open Enrollment Settings</a></li>
                    {#<li role="presentation"><a href="#priority" aria-controls="email" role="tab" data-toggle="tab">Priority Details</a></li>#}
                    {#<li role="presentation"><a href="#committee" aria-controls="email" role="tab" data-toggle="tab">Committee Score Settings</a></li>#}
                    <li role="presentation"><a href="#eligibility_settings" aria-controls="eligibility_settings" role="tab" data-toggle="tab">Eligibility Settings</a></li>
                    <li role="presentation"><a href="#gpa_settings" aria-controls="gpa_settings" role="tab" data-toggle="tab">GPA Settings</a></li>
                    <li role="presentation"><a href="#next_step_settings" aria-controls="next_step_settings" role="tab" data-toggle="tab">Next Step Settings</a></li>
                </ul>
                <div class="tab-content">
                    <div role="tabpanel" class="tab-pane active" id="enrollment_settings">
                        <div class="row">
                            <div class="col-md-12 form-group">
                                <div class="panel panel-default">
                                    <div class="panel-heading"><h3 class="panel-title">Open Enrollment</h3></div>
                                    <div class="panel-body">

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.openEnrollment.year) }}
                                                    {{ form_widget(form.openEnrollment.year , {'attr': {'class':'form-control'} } ) }}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.openEnrollment.confirmationStyle) }}
                                                    {{ form_widget(form.openEnrollment.confirmationStyle , {'attr': {'class':'form-control'} } ) }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.openEnrollment.beginningDate) }}
                                                    {{ form_widget(form.openEnrollment.beginningDate ) }}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.openEnrollment.endingDate) }}
                                                    {{ form_widget(form.openEnrollment.endingDate ) }}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.openEnrollment.latePlacementBeginningDate) }}
                                                    {{ form_widget(form.openEnrollment.latePlacementBeginningDate ) }}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.openEnrollment.latePlacementEndingDate) }}
                                                    {{ form_widget(form.openEnrollment.latePlacementEndingDate ) }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 form-group">
                                <div class="panel panel-default">
                                    <div class="panel-heading"><h3 class="panel-title">Racial Composition for each school after processing</h3></div>
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    {{ form_label(form.openEnrollment.HRCWhite) }}
                                                    {{ form_widget(form.openEnrollment.HRCWhite , {'attr': {'class':'form-control'} } ) }}
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    {{ form_label(form.openEnrollment.HRCBlack) }}
                                                    {{ form_widget(form.openEnrollment.HRCBlack , {'attr': {'class':'form-control'} } ) }}
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    {{ form_label(form.openEnrollment.HRCOther) }}
                                                    {{ form_widget(form.openEnrollment.HRCOther , {'attr': {'class':'form-control'} } ) }}
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-group">
                                                    {{ form_label(form.openEnrollment.maxPercentSwing) }}
                                                    {{ form_widget(form.openEnrollment.maxPercentSwing , {'attr': {'class':'form-control'} } ) }}
                                                </div>
                                            </div>
                                            <div class="col-md-12">
                                                <p>White, Black, and Other Racial Composition should add up to 100. Current Racial Totals:
                                                    <strong class="rctotal">%</strong></p>

                                                <p>Note: Current racial composition for all Schools is entered on the ADM Data tab of Process Submissions.</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12 form-group">
                                <div class="panel panel-default">
                                    <div class="panel-heading"><h3 class="panel-title">Application Cut Offs</h3><small>Applicants must be born on or before:</small></div>
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.preKDateCutOff) }}
                                                    {{ form_widget(form.preKDateCutOff) }}
                                                    {% if form.preKDateCutOff.vars.help is defined and form.preKDateCutOff.vars.help is not empty %}
                                                        <small>{{ form.preKDateCutOff.vars.help }}</small>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.kindergartenDateCutOff) }}
                                                    {{ form_widget(form.kindergartenDateCutOff) }}
                                                    {% if form.kindergartenDateCutOff.vars.help is defined and form.kindergartenDateCutOff.vars.help is not empty %}
                                                        <small>{{ form.kindergartenDateCutOff.vars.help }}</small>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>

                                        <hr/>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.firstGradeDateCutOff) }}
                                                    {{ form_widget(form.firstGradeDateCutOff) }}
                                                    {% if form.firstGradeDateCutOff.vars.help is defined and form.firstGradeDateCutOff.vars.help is not empty %}
                                                        <small>{{ form.firstGradeDateCutOff.vars.help }}</small>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.transcriptDueDate) }}
                                                    {{ form_widget(form.transcriptDueDate) }}
                                                    {% if form.transcriptDueDate.vars.help is defined and form.transcriptDueDate.vars.help is not empty %}
                                                        <small>{{ form.transcriptDueDate.vars.help }}</small>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 form-group">
                                <div class="panel panel-default">
                                    <div class="panel-heading"><h3 class="panel-title">Awarded Details</h3><small>Letters / Emails will contain the following deadlines &amp; details</small></div>
                                    <div class="panel-body">

                                        <h4>Enter the deadline to Accept offer</h4>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.onlineEndTime) }}
                                                    {{ form_widget(form.onlineEndTime) }}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.offlineEndTime) }}
                                                    {{ form_widget(form.offlineEndTime) }}
                                                </div>
                                            </div>
                                        </div>

                                        <hr/>

                                        <h4>Registration Start Information</h4>

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.registrationNewStartDate) }}
                                                    {{ form_widget(form.registrationNewStartDate) }}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.registrationCurrentStartDate) }}
                                                    {{ form_widget(form.registrationCurrentStartDate) }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 form-group">
                                <div class="panel panel-default">
                                    <div class="panel-heading"><h3 class="panel-title">Denied Details</h3><small>Letters / Emails will use these settings to identify when applications will be accepted again.</small></div>
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.nextSchoolYear) }}
                                                    {{ form_widget(form.nextSchoolYear , {'attr': {'class':'form-control'} } ) }}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.nextYear) }}
                                                    {{ form_widget(form.nextYear , {'attr': {'class':'form-control'} } ) }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12 form-group">
                                <div class="panel panel-default">
                                    <div class="panel-heading"><h3 class="panel-title">Wait List Details</h3></div>
                                    <div class="panel-body">
                                        <div class="row">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    {{ form_label(form.waitListExpireTime) }}
                                                    {{ form_widget(form.waitListExpireTime ) }}
                                                </div>
                                            </div>
                                        </div>

                                        <hr />

                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.waitListOnlineEndTime) }}
                                                    {{ form_widget(form.waitListOnlineEndTime ) }}
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-group">
                                                    {{ form_label(form.waitListOfflineEndTime) }}
                                                    {{ form_widget(form.waitListOfflineEndTime ) }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="eligibility_settings">
                        <div class="row">
                            <div class="col-md-12 form-group">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <h3 class="panel-title">Eligibility Settings</h3>
                                    </div>
                                    <div class="pane-body">

                                        {% if form.eligibility_settings is defined and form.eligibility_settings is not empty %}
                                        <table class="table not-fixed table-striped table-bordered table-condensed">
                                            <thead>
                                            <tr>
                                                <th>Program</th>
                                                <th>Required GPA</th>
                                                <th>Conduct</th>
                                                <th>Orientation</th>
                                                <th>Assessment Test</th>
                                                <th>Course Eligibility</th>
                                            </tr>
                                            </thead>

                                            <tfoot>
                                            <tr>
                                                <th>Program</th>
                                                <th>Required GPA</th>
                                                <th>Conduct</th>
                                                <th>Orientation</th>
                                                <th>Assessment Test</th>
                                                <th>Course Eligibility</th>
                                            </tr>
                                            </tfoot>

                                            <tbody>

                                                {% for eligibility_setting in form.eligibility_settings %}
                                                    <tr>
                                                        <th>{{ eligibility_setting.vars.value.name }}</th>

                                                        {% if eligibility_setting.vars.value.additionalData('calculated_gpa').first is not empty %}
                                                            {% set data = eligibility_setting.vars.value.additionalData('calculated_gpa').first.metaValue %}
                                                        {% else %}
                                                            {% set data = null %}
                                                        {% endif %}
                                                        <th>{{ form_widget(eligibility_setting.calculated_gpa , {'value':data, 'attr': {'class':'form-control'} } ) }}</th>

                                                        {% if eligibility_setting.vars.value.additionalData('conduct_eligible').first is not empty %}
                                                            {% set data = eligibility_setting.vars.value.additionalData('conduct_eligible').first.metaValue %}
                                                        {% else %}
                                                            {% set data = null %}
                                                        {% endif %}
                                                        <th>{{ form_widget(eligibility_setting.conduct_eligible , {'value':data, 'attr': {'class':'form-control'} } ) }}</th>

                                                        {% if eligibility_setting.vars.value.additionalData('orientation').first is not empty %}
                                                            {% set data = eligibility_setting.vars.value.additionalData('orientation').first.metaValue %}
                                                        {% else %}
                                                            {% set data = null %}
                                                        {% endif %}
                                                        <th>{{ form_widget(eligibility_setting.orientation , {'value':data, 'attr': {'class':'form-control'} } ) }}</th>

                                                        {% if eligibility_setting.vars.value.additionalData('assessment_test_eligible').first is not empty %}
                                                            {% set data = eligibility_setting.vars.value.additionalData('assessment_test_eligible').first.metaValue %}
                                                        {% else %}
                                                            {% set data = null %}
                                                        {% endif %}
                                                        <th>{{ form_widget(eligibility_setting.assessment_test_eligible , {'value':data, 'attr': {'class':'form-control'} } ) }}</th>

                                                        {% if eligibility_setting.vars.value.additionalData('course_eligibility_met').first is not empty %}
                                                            {% set data = eligibility_setting.vars.value.additionalData('course_eligibility_met').first.metaValue %}
                                                        {% else %}
                                                            {% set data = null %}
                                                        {% endif %}
                                                        <th>{{ form_widget(eligibility_setting.course_eligibility_met , {'value':data, 'attr': {'class':'form-control'} } ) }}</th>
                                                    </tr>

                                                {% endfor %}
                                            </tbody>
                                        </table>
                                    {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>



                    {#<div role="tabpanel" class="tab-pane" id="priority">#}
                        {#<div class="row">#}
                            {#<div class="col-md-12 form-group">#}
                                {#<div class="panel panel-default">#}
                                    {#<div class="panel-heading">#}
                                        {#<h3 class="panel-title">Priority Definitions</h3>#}
                                    {#</div>#}
                                    {#<div class="panel-body">#}
                                        {#<dl class="dl-horizontal">#}
                                            {#<dt>Current School Priority</dt>#}
                                            {#<dd>Submissions where current school is:#}
                                                {#<ul>#}
                                                    {#<li><strong>Academy For Academics And Arts</strong> and choice is any <strong>Lee School of Creative and Performing Arts</strong> Program</li>#}
                                                    {#<li><strong>Williams Middle-Magnet</strong> and choice is any <strong>New Century High School</strong> Program.</li>#}
                                                {#</ul>#}
                                            {#</dd>#}

                                            {#<dt>Majority Race Priority</dt>#}
                                            {#<dd>Submissions where <strong>Race</strong> is the Majority Race within Zoned School.</dd>#}

                                            {#<dt>Sibling Attend Priority</dt>#}
                                            {#<dd>Submissions where a <strong>Sibling</strong> will continue enrollment in a Magnet program at chosen school</dd>#}
                                        {#</dl>#}
                                    {#</div>#}
                                {#</div>#}

                                {#<div class="panel panel-default">#}
                                    {#<div class="panel-heading">#}
                                        {#<h3 class="panel-title">Display the Priority Breakout.</h3>#}
                                    {#</div>#}
                                    {#<div class="panel-body">#}
                                        {#<ol class="priority">#}
                                            {#<li>First Priority - Consist of Submissions that Pass:#}
                                                {#<ul class="list-inline">#}
                                                    {#<li>Current School Priority</li>#}
                                                    {#<li>Majority Race Priority</li>#}
                                                    {#<li>Sibling Attend Priority</li>#}
                                                {#</ul>#}
                                            {#</li>#}
                                            {#<li>Second Priority - Consist of Submissions that Pass:#}
                                                {#<ul class="list-inline">#}
                                                    {#<li>Current School Priority</li>#}
                                                    {#<li>Majority Race Priority</li>#}
                                                {#</ul>#}
                                            {#</li>#}
                                            {#<li>Third Priority - Consist of Submissions that Pass:#}
                                                {#<ul class="list-inline">#}
                                                    {#<li>Current School Priority</li>#}
                                                    {#<li>Sibling Attend Priority</li>#}
                                                {#</ul>#}
                                            {#</li>#}
                                            {#<li>Fourth Priority - Consist of Submissions that Pass:#}
                                                {#<ul class="list-inline">#}
                                                    {#<li>Current School Priority</li>#}
                                                {#</ul>#}
                                            {#</li>#}
                                            {#<li>Fifth Priority - Consist of Submissions that Pass:#}
                                                {#<ul class="list-inline">#}
                                                    {#<li>Majority Race Priority</li>#}
                                                    {#<li>Sibling Attend Priority</li>#}
                                                {#</ul>#}
                                            {#</li>#}
                                            {#<li>Sixth Priority - Consist of Submissions that Pass:#}
                                                {#<ul class="list-inline">#}
                                                    {#<li>Majority Race Priority</li>#}
                                                {#</ul>#}
                                            {#</li>#}
                                            {#<li>Seventh Priority - Consist of Submissions that Pass:#}
                                                {#<ul class="list-inline">#}
                                                    {#<li>Sibling Attend Priority</li>#}
                                                {#</ul>#}
                                            {#</li>#}
                                        {#</ol>#}
                                    {#</div>#}
                                {#</div>#}
                            {#</div>#}
                        {#</div>#}
                    {#</div>#}
                    {#<div role="tabpanel" class="tab-pane" id="committee" style="min-height:375px;">#}
                        {#<div class="row">#}
                            {#<div class="col-md-12">#}
                                {#{% if programs is defined and programs is not empty %}#}
                                    {#<div class="panel panel-default">#}
                                        {#<div class="panel-body">#}
                                            {#<div class="btn-group">#}
                                                {#<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">#}
                                                    {#Choose a Program <span class="caret"></span>#}
                                                {#</button>#}
                                                {#<ul class="dropdown-menu" role="menu">#}
                                                    {#{% for program in programs %}#}
                                                        {#<li>#}
                                                            {#<a class="changeMe" href="#program{{ program.id }}" data-program="{{ program.id }}">{{ program.name }}</a>#}
                                                        {#</li>#}
                                                    {#{% endfor %}#}
                                                {#</ul>#}
                                            {#</div>#}
                                        {#</div>#}
                                    {#</div>#}
                                    {#<div class="clear clearfix"></div>#}
                                {#{% endif %}#}
                            {#</div>#}
                            {#<div class="col-md-12 form-group">#}
                                {#{% if form.committee_settings is defined and form.committee_settings is not empty %}#}
                                        {#{% set lastProgram = '' %}#}
                                        {#{% set lastSchool = '' %}#}
                                        {#{% for committee in form.committee_settings %}#}
                                            {#{% if lastProgram != committee.vars.value.magnetSchool.program.id %}#}
                                                {#{% if lastProgram != '' %}#}
                                                    {#</tbody>#}
                                                {#</table>#}
                                                {#{% endif %}#}
                                                {#<table class="table not-fixed table-striped table-bordered table-condensed programs hide" data-program="{{ committee.vars.value.magnetSchool.program.id }}">#}
                                                    {#<thead>#}
                                                        {#<tr>#}
                                                            {#<th>&nbsp;</th>#}
                                                            {#<th class="text-center hide">Allow Wait List?</th>#}
                                                            {#<th class="text-center">Required Minimum <br />Committee Score?</th>#}
                                                            {#<th class="text-center">Minimum <br />Committee Score</th>#}
                                                        {#</tr>#}
                                                        {#<tr>#}
                                                            {#<th>&nbsp;</th>#}
                                                            {#<th class="text-center vertical-middle checker hide"><label><span data-checked="Uncheck All -" data-unchecked="Check All -"></span>&nbsp;<input type="checkbox" data-group="[waitList]" /></label></th>#}
                                                            {#<th class="text-center vertical-middle checker"><label><span data-checked="Uncheck All -" data-unchecked="Check All -"></span>&nbsp;<input type="checkbox" data-group="[committeeScoreRequired]" /></label></th>#}
                                                            {#<th class="text-center vertical-middle selector"><select data-program="{{ committee.vars.value.magnetSchool.program.id }}" data-group="[minimumCommitteeScore]"><option>Update All Minimum Score</option><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></th>#}
                                                        {#</tr>#}
                                                    {#</thead>#}
                                                    {#<tfoot>#}
                                                        {#<tr>#}
                                                            {#<th colspan="4" style="font-size:3px;">&nbsp;</th>#}
                                                        {#</tr>#}
                                                        {#<tr>#}
                                                            {#<th>&nbsp;</th>#}
                                                            {#<th class="text-center vertical-middle checker hide"><label><span data-checked="Uncheck All -" data-unchecked="Check All -"></span>&nbsp;<input type="checkbox" data-group="[waitList]" /></label></th>#}
                                                            {#<th class="text-center vertical-middle checker"><label><span data-checked="Uncheck All -" data-unchecked="Check All -"></span>&nbsp;<input type="checkbox" data-group="[committeeScoreRequired]" /></label></th>#}
                                                            {#<th class="text-center vertical-middle selector"><select data-program="{{ committee.vars.value.magnetSchool.program.id }}" data-group="[minimumCommitteeScore]"><option>Update All Minimum Score</option><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option></select></th>#}
                                                        {#</tr>#}
                                                        {#<tr>#}
                                                            {#<th>&nbsp;</th>#}
                                                            {#<th class="text-center hide">Allow Wait List?</th>#}
                                                            {#<th class="text-center">Required Minimum <br />Committee Score?</th>#}
                                                            {#<th class="text-center">Minimum <br />Committee Score</th>#}
                                                        {#</tr>#}
                                                    {#</tfoot>#}
                                                    {#<tbody>#}
                                                    {#{% set lastProgram = committee.vars.value.magnetSchool.program.id %}#}
                                            {#{% endif %}#}
                                                {#{% if lastSchool != committee.vars.value.magnetSchool.name %}#}
                                                    {#<tr>#}
                                                        {#<th colspan="4" style="font-size:3px;">&nbsp;</th>#}
                                                    {#</tr>#}
                                                    {#<tr>#}
                                                        {#<th colspan="4" class="info">{{ committee.vars.value.magnetSchool.name }} &ndash; Committee Settings</th>#}
                                                    {#</tr>#}
                                                {#{% set lastSchool = committee.vars.value.magnetSchool.name %}#}
                                                {#{% endif %}#}

                                                {#<tr>#}
                                                    {#<td class="vertical-middle">Grade {{ committee.vars.value.magnetSchool.gradeString }}</td>#}
                                                    {#<td class="text-center hide">{{ form_widget(committee.waitList , {'attr': {'class':'form-control'} } ) }}</td>#}
                                                    {#<td class="text-center">{{ form_widget(committee.committeeScoreRequired , {'attr': {'class':'form-control'} } ) }}</td>#}
                                                    {#<td class="text-center">{{ form_widget(committee.minimumCommitteeScore , {'attr': {'class':'form-control'} } ) }}<br/>#}
                                                    {#<i style="font-size: 80%;">Note: All applications with a score of less than this will be denied</i> </td>#}
                                                {#</tr>#}
                                        {#{% if loop.last %}#}
                                            {#</tbody>#}
                                        {#</table>#}
                                        {#{% endif %}#}
                                        {#{% endfor %}#}
                                        {#</tbody>#}
                                    {#</table>#}
                                {#{% endif %}#}
                            {#</div>#}
                        {#</div>#}
                    {#</div>#}
                    <div role="tabpanel" class="tab-pane" id="gpa_settings" style="min-height:475px;">
                        <div class="row">
                            <div class="col-md-12 form-group" style="display: none;">
                                <div class="panel panel-default">
                                    <div class="panel-heading"><h3 class="panel-title">GPA Settings</h3></div>
                                    <div class="panel-body">
                                        <div class="form-group">
                                            {{ form_widget(form.gpa_settings , {'attr': {'class':'form-control'} } ) }}
                                            {{ form_label(form.gpa_settings) }}
                                            <div class="clear clearfix"></div>
                                            {% if form.gpa_settings.vars.help is defined and form.gpa_settings.vars.help is not empty %}
                                                <small>{{ form.gpa_settings.vars.help }}</small>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-12">
                                {% if programs is defined and programs is not empty %}
                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                                    Choose a Program <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu" role="menu">
                                                    {% for program in programs %}
                                                        <li>
                                                            <a class="changeMe" href="#program{{ program.id }}" data-program="{{ program.id }}">{{ program.name }}</a>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clear clearfix"></div>
                                {% endif %}
                            </div>
                            <div class="col-md-12 form-group">
                                {% if form.gpa_settings is defined and form.gpa_settings is not empty %}
                                    {% set lastProgram = '' %}
                                    {% set lastSchool = '' %}

                                    {% for gpa_setting in form.gpa_settings %}

                                        {% if lastProgram != gpa_setting.vars.value.magnetSchool.program.id %}
                                            {% if lastProgram != '' %}
                                                </tbody>
                                            </table>
                                            {% endif %}
                                            <table class="table not-fixed table-striped table-bordered table-condensed programs hide" data-program="{{ gpa_setting.vars.value.magnetSchool.program.id }}">
                                                <thead>
                                                <tr>
                                                    <th>&nbsp;</th>
                                                    <th class="text-center">GPA Setting</th>
                                                    <th class="text-center">Courses to <br />Average</th>
                                                    <th class="text-center">Number of <br />Semesters</th>
                                                    <th class="text-center" style="display: none;">Comparison</th>
                                                    <th class="text-center firstColumn" style="display: none;">Passing <br />Threshold</th>
                                                </tr>
                                                <tr>
                                                    <th>&nbsp;</th>
                                                    <th class="text-center vertical-middle selector"><select data-program="{{ gpa_setting.vars.value.magnetSchool.program.id }}" data-group="[criteriaType]"><option>Update All Eligibilty Type</option><option value="">None</option><option value="GPA Check">GPA Check</option></select></th>
                                                    <th class="text-center vertical-middle checker"><label><span data-checked="Uncheck All -" data-unchecked="Check All -"></span>&nbsp;<input type="checkbox" data-group="[courseTypeToAverage][]" /></label></th>
                                                    <th class="text-center vertical-middle selector"><select data-program="{{ gpa_setting.vars.value.magnetSchool.program.id }}" data-group="[numberofSemesters]"><option>Update All Number of Semesters</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option></select></th>
                                                    <th class="text-center vertical-middle selector" style="display: none;"><select data-program="{{ gpa_setting.vars.value.magnetSchool.program.id }}" data-group="[comparison]"><option>Update All Comparisons</option><option value="" selected="selected">Select a Comparison</option><option value="=">Equals</option><option value=">=">Greater than or equals to</option><option value=">">Greater than</option><option value="<">Less than</option><option value="<=">Less than or equals to</option></select></th>
                                                    <th class="text-center vertical-middle inputer firstColumn" style="display: none;"><input style="width: 55px;" max="100" min="0" type="number" value="" data-group="[passingThreshold]" /></th>
                                                </tr>
                                                </thead>
                                                <tfoot>
                                                <tr>
                                                    <th colspan="6" style="font-size:3px;">&nbsp;</th>
                                                </tr>
                                                <tr>
                                                    <th>&nbsp;</th>
                                                    <th class="text-center vertical-middle selector"><select data-program="{{ gpa_setting.vars.value.magnetSchool.program.id }}" data-group="[criteriaType]"><option>Update All Eligibilty Type</option><option value="">None</option><option value="GPA Check">GPA Check</option></select></th>
                                                    <th class="text-center vertical-middle checker"><label><span data-checked="Uncheck All -" data-unchecked="Check All -"></span>&nbsp;<input type="checkbox" data-group="[courseTypeToAverage][]" /></label></th>
                                                    <th class="text-center vertical-middle selector"><select data-program="{{ gpa_setting.vars.value.magnetSchool.program.id }}" data-group="[numberofSemesters]"><option>Update All Number of Semesters</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option></select></th>
                                                    <th class="text-center vertical-middle selector" style="display: none;"><select data-program="{{ gpa_setting.vars.value.magnetSchool.program.id }}" data-group="[comparison]"><option>Update All Comparisons</option><option value="" selected="selected">Select a Comparison</option><option value="=">Equals</option><option value=">=">Greater than or equals to</option><option value=">">Greater than</option><option value="<">Less than</option><option value="<=">Less than or equals to</option></select></th>
                                                    <th class="text-center vertical-middle inputer firstColumn" style="display: none;"><input style="width: 55px;" max="100" min="0" type="number" value="" data-group="[passingThreshold]" /></th>
                                                </tr>
                                                <tr>
                                                    <th>&nbsp;</th>
                                                    <th class="text-center">GPA Setting</th>
                                                    <th class="text-center">Courses to <br />Average</th>
                                                    <th class="text-center">Number of <br />Semesters</th>
                                                    <th class="text-center" style="display: none;">Comparison</th>
                                                    <th class="text-center firstColumn" style="display: none;">Passing <br />Threshold</th>
                                                </tr>
                                                </tfoot>
                                                <tbody>
                                                {% set lastProgram = gpa_setting.vars.value.magnetSchool.program.id %}
                                        {% endif %}
                                        {% if lastSchool != gpa_setting.vars.value.magnetSchool.name %}
                                            <tr>
                                                <th colspan="6" style="font-size:3px;">&nbsp;</th>
                                            </tr>
                                            <tr>
                                                <th colspan="6" class="info">{{ gpa_setting.vars.value.magnetSchool.name }} &ndash; GPA Settings</th>
                                            </tr>
                                            {% set lastSchool = gpa_setting.vars.value.magnetSchool.name %}
                                        {% endif %}
                                        <tr>
                                            <td class="vertical-middle" style="white-space: nowrap;">Grade {{ gpa_setting.vars.value.magnetSchool.gradeString }}</td>
                                            <td class="text-center vertical-middle">
                                                {{ form_widget(gpa_setting.criteriaType , {'attr': {'class':'form-control'} } ) }}
                                            </td>
                                            <td class="vertical-middle">
                                                {% for course in gpa_setting.courseTypeToAverage.children %}
                                                    {% if loop.first %}
                                                    <ul style="" class="list-unstyled">
                                                    {% endif %}
                                                        <li><label style="margin-bottom:0;">{{ form_widget(course , {'attr': {'class':''} } ) }}&nbsp;{{ form_label(course) }}</label></li>
                                                    {% if loop.last %}
                                                    </ul>
                                                    {% endif %}
                                                {% endfor %}
                                            </td>
                                            <td class="text-center vertical-middle">{{ form_widget(gpa_setting.numberofSemesters , {'attr': {'class':'form-control'} } ) }}</td>

                                            <td class="text-center vertical-middle" style="display: none;">{{ form_widget(gpa_setting.comparison , {'attr': {'class':'form-control'} } ) }}</td>
                                            <td class="text-center vertical-middle firstColumn" style="display: none;">{{ form_widget(gpa_setting.passingThreshold ) }}</td>
                                        </tr>
                                        {#
                                        Hiding Course Title Check because Magnet never used it.
                                        <tr class="course">
                                            <td class="vertical-middle">Grade {{ gpa_setting.vars.value.magnetSchool.gradeString }} - Course Title Settings</td>
                                            <td class="text-center" colspan="2">
                                                {% for course in gpa_setting.courseTypeToCheckTitle.children %}
                                                    {% if loop.first %}
                                                        <ul style="margin-bottom:0; padding-left: 0;">
                                                    {% endif %}
                                                            <li class="radio-inline"><label style="margin-bottom:0;">{{ form_widget(course , {'attr': {'class':''} } ) }}&nbsp;{{ form_label(course) }}</label></li>
                                                    {% if loop.last %}
                                                        </ul>
                                                    {% endif %}
                                                {% endfor %}
                                            </td>
                                            <td class="text-center" colspan="2">{{ form_widget(gpa_setting.courseTitle , {'attr': {'class':'form-control'} } ) }}</td>
                                        </tr>#}
                                    {% if loop.last %}
                                        </tbody>
                                    </table>
                                    {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <div role="tabpanel" class="tab-pane" id="next_step_settings">
                        <div class="row">
                            <div class="col-md-12">
                                {% if programs is defined and programs is not empty %}
                                    <div class="panel panel-default">
                                        <div class="panel-body">
                                            <div class="btn-group">
                                                <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false">
                                                    Choose a Program <span class="caret"></span>
                                                </button>
                                                <ul class="dropdown-menu" role="menu">
                                                    {% for program in programs %}
                                                        <li>
                                                            <a class="changeMe" href="#program{{ program.id }}" data-program="{{ program.id }}">{{ program.name }}</a>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="clear clearfix"></div>
                                {% endif %}
                            </div>

                            <div class="col-md-12 form-group">
                                {% if form.next_step is defined and form.next_step is not empty %}
                                    {% set lastProgram = '' %}
                                    {% set lastSchool = '' %}

                                    {%  for nextStep in form.next_step %}
                                        {% if lastProgram != nextStep.vars.value.magnetSchool.program.id %}

                                            {% if lastProgram != '' %}
                                                </tbody>
                                            </table>
                                            {% endif %}

                                            <table class="table not-fixed table-striped table-bordered table-condensed programs hide" data-program="{{ nextStep.vars.value.magnetSchool.program.id }}">
                                                <thead>
                                                    <tr>
                                                        <th></th>
                                                        <th class="text-center">Interview Required?</th>
                                                        <th class="text-center" style="width: 75%;">Special Instructions</th>
                                                    </tr>
                                                    <tr>
                                                        <th>&nbsp;</th>
                                                        <th class="text-center vertical-middle selector"><select data-program="{{ nextStep.vars.value.magnetSchool.program.id }}" data-group="[interview]"><option>Update All Interview Required</option><option value="0">Not Required</option><option value="1">Required</option></select></th>

                                                        <th class="text-center vertical-middle texter">
                                                            <textarea data-program="{{ nextStep.vars.value.magnetSchool.program.id }}" data-group="[specialRequirement]" placeholder="Update Special Instructions" class="form-control"></textarea>
                                                        </th>
                                                    </tr>
                                                </thead>
                                                <tfoot>
                                                    <tr>
                                                        <th colspan="3" style="font-size:3px;">&nbsp;</th>
                                                    </tr>
                                                    <tr>
                                                        <th>&nbsp;</th>
                                                        <th class="text-center vertical-middle selector"><select data-program="{{ nextStep.vars.value.magnetSchool.program.id }}" data-group="[interview]"><option>Update All Interview Required</option><option value="0">Not Required</option><option value="1">Required</option></select></th>

                                                        <th class="text-center vertical-middle texter">
                                                            <textarea data-program="{{ nextStep.vars.value.magnetSchool.program.id }}" data-group="[specialRequirement]" placeholder="Update Special Instructions" class="form-control"></textarea>
                                                        </th>
                                                    </tr>
                                                    <tr>
                                                        <th></th>
                                                        <th class="text-center">Interview Required?</th>
                                                        <th class="text-center">Special Instructions</th>
                                                    </tr>
                                                </tfoot>
                                        {% endif %}

                                        {% if lastSchool != nextStep.vars.value.magnetSchool.name or lastProgram != nextStep.vars.value.magnetSchool.program.id %}
                                            <tbody>
                                                <tr>
                                                     <th colspan="3" style="font-size:3px;">&nbsp;</th>
                                                </tr>
                                                 <tr>
                                                    <th colspan="3" class="info">{{ nextStep.vars.value.magnetSchool.name }} &ndash; Next Step Settings</th>
                                                </tr>
                                        {% endif %}

                                            <tr>
                                                <td class="vertical-middle">Grade {{ nextStep.vars.value.magnetSchool.gradeString }}</td>
                                                <td class="text-center vertical-middle">
                                                    {{ form_widget(nextStep.interview , {'attr': {'class':'form-control', 'data-dependable':'interview' } } ) }}
                                                </td>

                                                <td class="text-center vertical-middle">
                                                    {{ form_widget(nextStep.specialRequirement , {'attr': {'class':'form-control', 'placeholder': 'special instructions'} } ) }}
                                                </td>
                                            </tr>

                                        {% set lastSchool = nextStep.vars.value.magnetSchool.name %}
                                        {% set lastProgram = nextStep.vars.value.magnetSchool.program.id %}
                                        {% if loop.last %}
                                            </tbody>
                                        </table>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {{ form_rest(form) }}
                </div>
            </div>
            {{ form_end(form) }}
        </div>
    </div>

{% endblock %}
